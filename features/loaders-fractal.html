<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fractal Loader - Tapspace Features</title>

  <!-- Mobile-friendly width settings. Disables default browser zooming
       features native gestures. -->
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- your custom styles -->
  <style>
    body {
      background: black;
      color: grey;
    }
    .myspaceapp {
      background: white;
      height: 500px;
    }
    .mycomponent {
      background: white;
      color: black;
    }
    .mylabel {
      margin-top: 1rem;
      padding: 1rem;
      text-align: center;
      font-size: 2rem;
    }
    .fractal-node {
      padding: 20px;
      color: white;
      word-break: break-all;
    }
    .mycomponent.active {
      background: #EEE;
    }
  </style>
</head>
<body>
  <h1>Fractal loader â€“ Tapspace Features</h1>
  <p>
    Recursive loading and unloading of content is necessary in order
    to explore huge masses of data. Otherwise web browsers would slow down
    to tar under the load of thousands of elements.
  </p>

  <!-- A tapspace viewport -->
  <div id="tapspace" class="myspaceapp"></div>

  <!-- Import tapspace. -->
  <script src="../dist/tapspace.min.js"></script>

  <!-- Your code -->
  <script>
    // Setup the tapspace viewport and the default layer for content.
    // Make the viewport responsive
    const viewport = tapspace.createView('#tapspace')
    viewport.responsive().zoomable().setMeasureMode('none')

    const getParentIds = (id) => {
      if (id.length <= 1) {
        return null
      }
      const pid = id.substring(0, id.length - 1)
      return pid
    }

    const kernel = (id) => {
      return {
        plane: {
          id: id,
          transform: { a: 0.32, b: 0, x: 0, y: 0, z: 50 }
        },
        children: [
          {
            id: id + '0',
            transform: { a: 1, b: 0, x: 100, y: 100, z: 0 }
          },
          {
            id: id + '1',
            transform: { a: 1, b: 0, x: 120, y: 0, z: 0 }
          }
        ]
      }
    }

    const getDepth = (id) => {
      return id.length - 1
    }

    const getColor = (id) => {
      const d = getDepth(id)
      const redness = d * 40
      const color = 'rgb(' + redness + ', 0, 0)'
      return color
    }

    const createNode = (id) => {
      const size = 50
      const color = getColor(id)
      const node = tapspace.createCircle(size, color)
      node.html('' + id)
      node.addClass('fractal-node')
      return node
    }

    const loader = new tapspace.loaders.FractalLoader({
      viewport: viewport,
      kernel: kernel,
      backtracker: getParentIds,
      generator: createNode,
      initial: '0'
    })
  </script>
</body>
</html>
