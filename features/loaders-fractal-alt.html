<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fractal Loader Alt - Tapspace Features</title>

  <!-- Mobile-friendly width settings. Disables default browser zooming
       features native gestures. -->
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- your custom styles -->
  <style>
    body {
      background: black;
      color: grey;
    }
    .myspaceapp {
      background: white;
      height: 500px;
    }
  </style>
</head>
<body>
  <h1>Alternative Fractal loader â€“ Tapspace Features</h1>
  <p>
    Recursive loading and unloading of content is necessary in order
    to explore huge masses of data. Otherwise web browsers would slow down
    to tar under the load of thousands of elements.
  </p>

  <!-- A tapspace viewport -->
  <div id="tapspace" class="myspaceapp"></div>

  <!-- Import tapspace. -->
  <script src="../dist/tapspace.min.js"></script>

  <!-- Your code -->
  <script>
    // Setup the tapspace viewport and the default layer for content.
    const viewport = tapspace.createView('#tapspace')
    viewport.zoomable()

    const loader = new tapspace.loaders.FractalLoaderAlt({
      viewport: viewport,

      placeholder: function (id) {
        // Render placeholder
        const plane = tapspace.createPlane()
        const circle = tapspace.createCircle(10, 'black')
        plane.addChild(circle, plane.at(15, 15))
        return plane
      },

      generator: function (id, data) {
        // Render content to replace the placeholder
        const item = tapspace.createCircle(15, data.color)
        item.element.title = 'id:' + id

        item.tappable()
        item.on('tap', () => {
          loader.openChild(id, id + 'a')
        })

        return item
      },

      fetcher: function (id, callback) {
        // Async call to fetch data for the generator.
        setTimeout(() => {
          callback(null, { color: 'red' })
        }, 400)
      },

      tracker: function (parent, childId) {
        // Find basis for a child given a parent.
        return parent.getBasis().offset(30, 0)
      },

      backer: function (childId) {
        // Find parent id.
        if (childId.length <= 1) {
          return null
        }
        return childId.substring(0, childId.length - 1)
      },

      limiter: function (depth) {
        // Limit recursion
        return depth < 3
      }
    })

    const firstBasis = tapspace.geometry.Basis.fromPoints(
      viewport,
      viewport.atCenter(),
      viewport.atCenter().offset(1, 0)
    )

    loader.init('aa', firstBasis, (err) => {
      if (err) {
        console.error(err)
        return
      }

      // loader.openChild('a', 'aa')
      loader.openParent('aa', () => console.log('parent'))
    })

  </script>
</body>
</html>
